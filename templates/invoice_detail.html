{% extends "layout.html" %}

{% block title %}Invoice {{ bill.bill_no }} - Crusher Billing{% endblock %}

{% block extra_css %}
<style>
  @media print {
    body {
      background: white !important;
      color: black !important;
      print-color-adjust: exact;
      -webkit-print-color-adjust: exact;
      font-family: 'Noto Sans Tamil', 'Poppins', sans-serif !important;
    }
    .no-print { display: none !important; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #000; padding: 6px; text-align: center; }
  }
</style>
{% endblock %}

{% block content %}
<div class="space-y-3">
  <div class="flex flex-wrap gap-2 no-print mb-2">
    <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-semibold">
      <i class="bi bi-printer"></i> Print
    </button>
    <a href="{{ url_for('invoice_pdf', bill_id=bill.id) }}" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm font-semibold">
      <i class="bi bi-download"></i> PDF
    </a>
    <button onclick="shareWhatsApp()" class="bg-[#25D366] hover:opacity-90 text-white px-3 py-1 rounded text-sm font-semibold">
      <i class="bi bi-whatsapp"></i> WhatsApp
    </button>
  </div>

  <div class="border-b border-gray-300 pb-2 mb-2">
    <div class="flex flex-col md:flex-row items-start gap-2">
      <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="h-12 w-12 object-contain" onerror="this.style.display='none'">
      <div class="flex-1 text-left md:text-right">
        <div class="text-lg font-semibold text-blue-800">{{ company_settings.company_name_tamil }}</div>
        <div class="text-sm text-blue-900">{{ company_settings.company_name_english }}</div>
        <div class="text-xs mt-1">{{ company_settings.address_tamil|replace('\n', '<br>')|safe }}</div>
        <div class="text-xs mt-1"><strong>GSTIN:</strong> {{ company_settings.gstin }} | <strong>üìû</strong> {{ company_settings.phone_numbers }}</div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-2">
    <div class="bg-gray-50 rounded p-2 border border-gray-200">
      <h5 class="font-semibold text-sm mb-1">Bill Details</h5>
      <p class="text-xs"><strong>Bill No:</strong> {{ bill.bill_no }}</p>
      <p class="text-xs"><strong>‡Æ§‡Øá‡Æ§‡Æø / Date:</strong> {{ bill.date.strftime('%d-%m-%Y %H:%M') }}</p>
    </div>
    <div class="bg-gray-50 rounded p-2 border border-gray-200">
      <h5 class="font-semibold text-sm mb-1">Customer</h5>
      <p class="text-xs"><strong>‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç:</strong> {{ bill.customer.name }}</p>
      {% if bill.customer.gst_number %}<p class="text-xs"><strong>GST:</strong> {{ bill.customer.gst_number }}</p>{% endif %}
      {% if bill.vehicle %}<p class="text-xs"><strong>‡Æµ‡Ææ‡Æï‡Æ© ‡Æé‡Æ£‡Øç:</strong> {{ bill.vehicle.vehicle_number }}</p>{% endif %}
    </div>
  </div>

  <div class="scroll-container">
    <table class="text-sm">
      <thead class="bg-gray-100 font-semibold">
        <tr>
          <th class="px-2 py-1">S.No</th>
          <th class="px-2 py-1">‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ≥‡Øç / Item</th>
          <th class="px-2 py-1">‡ÆÖ‡Æ≥‡Æµ‡ØÅ / Qty</th>
          <th class="px-2 py-1">‡Æµ‡Æø‡Æ≤‡Øà / Rate</th>
          <th class="px-2 py-1">‡Æ§‡Øä‡Æï‡Øà / Amount</th>
          <th class="px-2 py-1">GST (5%)</th>
          <th class="px-2 py-1">‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç / Total</th>
        </tr>
      </thead>
      <tbody class="text-center">
        <tr>
          <td class="px-2 py-1">1</td>
          <td class="px-2 py-1 text-left">{{ bill.item.name }}</td>
          <td class="px-2 py-1">{{ "%.2f"|format(bill.quantity) }}</td>
          <td class="px-2 py-1">‚Çπ{{ "%.2f"|format(bill.rate) }}</td>
          <td class="px-2 py-1">‚Çπ{{ "%.2f"|format(bill.total) }}</td>
          <td class="px-2 py-1">‚Çπ{{ "%.2f"|format(bill.gst) }}</td>
          <td class="px-2 py-1 font-semibold">‚Çπ{{ "%.2f"|format(bill.grand_total) }}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr class="bg-gray-50">
          <td colspan="5" class="px-2 py-1 text-right font-semibold">Subtotal:</td>
          <td colspan="2" class="px-2 py-1 text-center font-semibold">‚Çπ{{ "%.2f"|format(bill.total) }}</td>
        </tr>
        <tr class="bg-gray-50">
          <td colspan="5" class="px-2 py-1 text-right font-semibold">GST (5%):</td>
          <td colspan="2" class="px-2 py-1 text-center font-semibold">‚Çπ{{ "%.2f"|format(bill.gst) }}</td>
        </tr>
        <tr class="bg-blue-600 text-white">
          <td colspan="5" class="px-2 py-1 text-right font-bold">Grand Total:</td>
          <td colspan="2" class="px-2 py-1 text-center font-bold">‚Çπ{{ "%.2f"|format(bill.grand_total) }}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="text-center text-sm text-gray-700 font-semibold mt-2">{{ company_settings.footer_message or '‡Æ®‡Æ©‡Øç‡Æ±‡Æø!' }}</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function shareWhatsApp() {
    const billNo = '{{ bill.bill_no }}';
    const total = '{{ bill.grand_total }}';
    const text = `Bill Number: ${billNo}\nTotal: ‚Çπ${total}\n\nView invoice: ${window.location.href}`;
    const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank');
}
</script>
{% endblock %}
